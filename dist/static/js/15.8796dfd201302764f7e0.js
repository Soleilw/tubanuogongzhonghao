webpackJsonp([15],{Oqm6:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t("mvHQ"),i=t.n(r),a=t("n5Qe"),o=t("YpoW"),n=t.n(o),l=/^1[3-9]\d{9}$/,c=/^[1-9]\d{5}(18|19|20|(3\d))\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,h={data:function(){return{userInfor:{user_openid:sessionStorage.getItem("openId"),user_address:""},sexList:["男","女"],showPicker1:!1,worker:!1,disabled1:!1,workerInfor:{user_openid:sessionStorage.getItem("openId"),staff_status:0,user_images1:""},swi_teacher:!1,charge:!1,disabled2:!1,disabled3:!1,teacherInfor:{teacher:"",user_head1:"",user_openid:sessionStorage.getItem("openId"),whether:"",class_id:""},showPicker2:!1,showPicker3:!1,gradeList:[],classList:[],disabled4:!1,register:"",fileList:[],files:{name:"",type:""},deletable:!0,headerImage:null}},created:function(){$("title").text("用户信息")},mounted:function(){this.getGrade(),this.getUserInfo()},methods:{getUserInfo:function(){var e=this;a.p({user_openid:sessionStorage.getItem("openId")},function(s){"ok"==s.msg?(console.log(s.user),e.userInfor=s.user,e.workerInfor=s.user,e.teacherInfor=s.user,e.disabled4=!0,1===s.user.apply_teacher&&(e.swi_teacher=!0,e.disabled1=!0,e.disabled2=!0,e.disabled3=!0,e.disabled4=!0,e.deletable=!1,1===s.user.whether&&(e.charge=!0),e.fileList[0]={url:e.userInfor.user_head1},e.$set(e.fileList)),1===s.user.apply_staff&&(e.worker=!0,e.swi_teacher=!1,e.deletable=!1,e.disabled4=!0,e.disabled2=!0,e.disabled1=!0,e.fileList[0]={url:e.userInfor.user_images1})):e.register=s.msg})},onSubmit:function(){return c.test(this.userInfor.user_card)?l.test(this.userInfor.user_iphone)?(!1===this.worker&&!1===this.swi_teacher&&(this.userInfor.user_name&&this.userInfor.user_sex&&this.userInfor.user_card&&this.userInfor.user_iphone&&this.userInfor.user_address?(console.log(1),this.postUser()):this.$toast.fail("请补充完整信息")),!0===this.worker&&!1===this.swi_teacher&&(this.userInfor.user_name&&this.userInfor.user_sex&&this.userInfor.user_card&&this.userInfor.user_iphone&&this.userInfor.user_address&&this.workerInfor.date1&&this.workerInfor.positions&&this.workerInfor.user_images1?(console.log(2),this.postUser(),this.postWorker()):this.$toast.fail("请补充完整信息")),void(!1===this.worker&&!0===this.swi_teacher&&(this.userInfor.user_name&&this.userInfor.user_sex&&this.userInfor.user_card&&this.userInfor.user_iphone&&this.userInfor.user_address&&this.teacherInfor.class_grade&&this.teacherInfor.class_name&&this.teacherInfor.work_number&&this.teacherInfor.subjects&&this.teacherInfor.user_head1?(console.log(3),this.postUser(),this.postTeacher()):this.$toast.fail("请补充完整信息")))):(this.$toast.fail("手机号码格式不正确"),""):(this.$toast.fail("请填写有效的身份证号码"),"")},postUser:function(){var e=this;a.q(i()(e.userInfor),function(s){"ok"==s.msg&&(e.$toast.success("添加成功"),e.getUserInfo(),e.disabled4=!0,setTimeout(function(){e.$router.push("/personal")},2e3))})},postWorker:function(){var e=this;!0===e.worker&&(e.workerInfor.staff_status=0),a.q(i()(e.workerInfor),function(s){"ok"==s.msg&&(e.$toast.success("添加成功"),e.getUserInfo(),e.disabled1=!0,e.disabled2=!0,e.disabled3=!0,e.disabled4=!0,e.deletable=!1,setTimeout(function(){e.$router.push("/personal")},2e3))})},postTeacher:function(){var e=this;!0===e.swi_teacher?e.teacherInfor.teacher=1:!1===e.swi_teacher&&(e.teacherInfor.teacher=0),!0===e.charge?e.teacherInfor.whether=1:!1===e.charge&&(e.teacherInfor.whether=0),a.q(i()(e.teacherInfor),function(s){"ok"==s.msg&&(e.$toast.success("添加成功"),e.getUserInfo(),e.disabled1=!0,e.disabled2=!0,e.disabled3=!0,e.disabled4=!0,e.deletable=!1,setTimeout(function(){e.$router.push("/personal")},2e3))})},switch1:function(){!0===this.worker&&(this.swi_teacher=!1),!0===this.worker?this.disabled4=!1:!1===this.worker&&(this.disabled4=!0)},switch2:function(){!0===this.swi_teacher&&(this.worker=!1),!0===this.swi_teacher?this.disabled4=!1:!1===this.swi_teacher&&(this.disabled4=!0)},sexOnChange:function(e,s,t){this.userInfor.user_sex=s+1,this.showPicker1=!1},getGrade:function(){var e=this;a.j({},function(s){"ok"===s.msg&&(e.gradeList=s.data)})},getClass:function(e){var s=this;a.h({grade:e},function(e){"ok"===e.msg&&(s.classList=e.data)})},gradeOnChange:function(e){console.log(e),this.userInfor.class_grade=e,this.showPicker2=!1,this.getClass(e)},classOnChange:function(e){console.log(e),this.userInfor.class_name=e.text,this.userInfor.class_id=e.class_id,this.showPicker3=!1},deleteFile:function(e,s){!0===this.worker&&(this.workerInfor.user_images1="",this.fileList=[],this.$set(this.workerInfor,this.fileList)),!0===this.swi_teacher&&(this.teacherInfor.user_head1="",this.fileList=[],this.$set(this.teacherInfor,this.fileList))},afterRead:function(e){e.status="uploading",e.message="上传中...",e.content="",this.files.name=e.file.name,this.files.type=e.file.type,this.imgPreview(e.file)},postImg:function(){var e=this,s=new FormData,t=e.dataURLtoFile(e.headerImage);s.append("file",t),s.append("name",t.name),console.log(s),!0===e.worker?a.e(s,function(s){console.log(s),s.sucesss?(e.fileList[0].status="",e.fileList[0].message="",e.fileList[0].url=s.sucesss,e.fileList[0].content=s.sucesss,e.$set(e.fileList),console.log(e.fileList),e.workerInfor.user_images1=s.sucesss):(e.fileList[0].status="failed",e.fileList[0].message="上传失败",e.$set(e.fileList),e.$toast.fail(s.error))}):!0===e.swi_teacher&&a.e(s,function(s){console.log(s),s.sucesss?(e.fileList[0].status="",e.fileList[0].message="",e.fileList[0].url=s.sucesss,e.fileList[0].content=s.sucesss,e.$set(e.fileList),console.log(e.fileList),e.teacherInfor.user_head1=s.sucesss):(e.fileList[0].status="failed",e.fileList[0].message="上传失败",e.$set(e.fileList),e.$toast.fail(s.error))})},imgPreview:function(e){var s,t=this;if(console.log(i()(n.a)),n.a.getData(e,function(){s=n.a.getTag(this,"Orientation")}),e&&window.FileReader&&/^image/.test(e.type)){var r=new FileReader;r.readAsDataURL(e),r.onloadend=function(){var e=this.result,r=new Image;r.src=e,this.result.length<=102400?(t.headerImage=this.result,t.postImg()):r.onload=function(){var e=t.compress(r,s);t.headerImage=e,t.postImg()}}}},dataURLtoFile:function(e){for(var s=e.split(","),t=atob(s[1]),r=t.length,i=new Uint8Array(r);r--;)i[r]=t.charCodeAt(r);return new File([i],this.files.name,{type:this.files.type})},rotateImg:function(e,s,t){if(null!=e){var r=e.height,i=e.width,a=2;null==a&&(a=0),"right"==s?++a>3&&(a=0):--a<0&&(a=3);var o=90*a*Math.PI/180,n=t.getContext("2d");switch(a){case 0:t.width=i,t.height=r,n.drawImage(e,0,0);break;case 1:t.width=r,t.height=i,n.rotate(o),n.drawImage(e,0,-r);break;case 2:t.width=i,t.height=r,n.rotate(o),n.drawImage(e,-i,-r);break;case 3:t.width=r,t.height=i,n.rotate(o),n.drawImage(e,-i,0)}}},compress:function(e,s){var t,r,i=document.createElement("canvas"),a=i.getContext("2d"),o=document.createElement("canvas"),n=o.getContext("2d"),l=e.src.length,c=e.width,h=e.height;if((t=c*h/4e6)>1?(console.log("大于400万像素"),c/=t=Math.sqrt(t),h/=t):t=1,i.width=c,i.height=h,a.fillStyle="#fff",a.fillRect(0,0,i.width,i.height),(r=c*h/1e6)>1){console.log("超过100W像素");var u=~~(c/(r=~~(Math.sqrt(r)+1))),d=~~(h/r);o.width=u,o.height=d;for(var f=0;f<r;f++)for(var g=0;g<r;g++)n.drawImage(e,f*u*t,g*d*t,u*t,d*t,0,0,u,d),a.drawImage(o,f*u,g*d,u,d)}else a.drawImage(e,0,0,c,h);if(""!=s&&1!=s)switch(s){case 6:this.rotateImg(e,"left",i);break;case 8:this.rotateImg(e,"right",i);break;case 3:this.rotateImg(e,"right",i),this.rotateImg(e,"right",i)}var _=i.toDataURL("image/jpeg",.1);return console.log("压缩前："+l),console.log("压缩后："+_.length),console.log("压缩率："+~~(100*(l-_.length)/l)+"%"),o.width=o.height=i.width=i.height=0,_}}},u={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",[t("div",{staticClass:"content"},[t("van-form",{on:{submit:e.onSubmit}},[e.userInfor.user_image?t("div",{staticClass:"van-cell van-field"},[t("div",{staticClass:"van-cell__title van-field__label"},[t("span",[e._v("头像")])]),e._v(" "),t("div",{staticClass:"van-cell__value van-field__value"},[t("div",{staticClass:"van-field__body"},[t("div",{staticClass:"van-field__control van-field__control--right"},[t("img",{staticStyle:{width:"26vw",height:"24vw","border-radius":"2vw"},attrs:{src:e.userInfor.user_image,alt:""}})])])])]):e._e(),e._v(" "),t("van-field",{attrs:{type:"text",label:"姓名",placeholder:"请填写姓名","input-align":"right",required:""},model:{value:e.userInfor.user_name,callback:function(s){e.$set(e.userInfor,"user_name",s)},expression:"userInfor.user_name"}}),e._v(" "),t("van-field",{attrs:{value:e.sexList[e.userInfor.user_sex-1],type:"text",label:"性别",placeholder:"点击选择","input-align":"right",required:""},on:{click:function(s){e.showPicker1=!0}}}),e._v(" "),t("van-field",{attrs:{type:"text",label:"证件号",placeholder:"请填写证件号","input-align":"right",required:""},model:{value:e.userInfor.user_card,callback:function(s){e.$set(e.userInfor,"user_card",s)},expression:"userInfor.user_card"}}),e._v(" "),t("van-field",{attrs:{type:"text",label:"手机号",placeholder:"请填写手机号","input-align":"right",required:""},model:{value:e.userInfor.user_iphone,callback:function(s){e.$set(e.userInfor,"user_iphone",s)},expression:"userInfor.user_iphone"}}),e._v(" "),t("van-field",{attrs:{type:"textarea",label:"地址",placeholder:"请填写地址","input-align":"right",autosize:"","show-word-limit":"",maxlength:"50",required:""},model:{value:e.userInfor.user_address,callback:function(s){e.$set(e.userInfor,"user_address",s)},expression:"userInfor.user_address"}}),e._v(" "),t("van-cell",{attrs:{center:"",title:"是否本校职工",required:""}},[t("van-switch",{attrs:{size:"20",disabled:e.disabled1},on:{change:e.switch1},model:{value:e.worker,callback:function(s){e.worker=s},expression:"worker"}})],1),e._v(" "),e.worker?t("div",[t("van-field",{attrs:{type:"text",label:"部门",placeholder:"请填写部门","input-align":"right",required:""},model:{value:e.workerInfor.date1,callback:function(s){e.$set(e.workerInfor,"date1",s)},expression:"workerInfor.date1"}}),e._v(" "),t("van-field",{attrs:{type:"text",label:"职位",placeholder:"请填写职位","input-align":"right",required:""},model:{value:e.workerInfor.positions,callback:function(s){e.$set(e.workerInfor,"positions",s)},expression:"workerInfor.positions"}})],1):e._e(),e._v(" "),t("van-cell",{attrs:{center:"",title:"是否本校教师",required:""}},[t("van-switch",{attrs:{size:"20",disabled:e.disabled2},on:{change:e.switch2},model:{value:e.swi_teacher,callback:function(s){e.swi_teacher=s},expression:"swi_teacher"}})],1),e._v(" "),e.swi_teacher?t("div",[t("van-cell",{attrs:{center:"",title:"是否是班主任",required:""}},[t("van-switch",{attrs:{size:"20",disabled:e.disabled3},model:{value:e.charge,callback:function(s){e.charge=s},expression:"charge"}})],1),e._v(" "),t("van-field",{attrs:{type:"text",label:"工号",placeholder:"请填写工号","input-align":"right",required:""},model:{value:e.teacherInfor.work_number,callback:function(s){e.$set(e.teacherInfor,"work_number",s)},expression:"teacherInfor.work_number"}}),e._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",label:"年级",value:e.userInfor.class_grade,placeholder:"请选择年级","input-align":"right",required:""},on:{click:function(s){e.showPicker2=!0}}}),e._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",label:"班级",value:e.userInfor.class_name,placeholder:"请选择班级","input-align":"right",required:""},on:{click:function(s){e.showPicker3=!0}}}),e._v(" "),t("van-field",{attrs:{type:"text",label:"学科",placeholder:"请填写学科","input-align":"right",required:""},model:{value:e.teacherInfor.subjects,callback:function(s){e.$set(e.teacherInfor,"subjects",s)},expression:"teacherInfor.subjects"}})],1):e._e(),e._v(" "),!0===e.worker||!0===e.swi_teacher?t("div",[t("van-cell",{attrs:{required:"",title:"人脸数据(点击图片更换)"}},[t("div",{staticClass:"van-cell__value van-field__value"},[t("div",{staticClass:"van-field__body"},[t("div",{staticClass:"van-field__control van-field__control--right"},[t("van-uploader",{attrs:{"preview-size":"100px","after-read":e.afterRead,"max-count":1,delete:e.deleteFile,deletable:e.deletable},model:{value:e.fileList,callback:function(s){e.fileList=s},expression:"fileList"}})],1)])])])],1):e._e(),e._v(" "),t("div",{staticStyle:{width:"70vw",margin:"15vw auto"}},[t("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit",size:"small",disabled:e.disabled4}},[e._v("\n\t\t\t\t\t提交审核\n\t\t\t\t")])],1)],1)],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker1,callback:function(s){e.showPicker1=s},expression:"showPicker1"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.sexList},on:{confirm:e.sexOnChange,cancel:function(s){e.showPicker1=!1}}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker2,callback:function(s){e.showPicker2=s},expression:"showPicker2"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.gradeList},on:{cancel:function(s){e.showPicker2=!1},confirm:e.gradeOnChange}})],1),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker3,callback:function(s){e.showPicker3=s},expression:"showPicker3"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.classList},on:{cancel:function(s){e.showPicker3=!1},confirm:e.classOnChange}})],1)],1)},staticRenderFns:[]};var d=t("VU/8")(h,u,!1,function(e){t("Wvb1")},null,null);s.default=d.exports},Wvb1:function(e,s){}});