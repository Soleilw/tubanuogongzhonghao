webpackJsonp([17],{"8ANU":function(e,t){},yycs:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),r=a("7+uW"),o=a("Fd2+"),l=(a("4ml/"),a("n5Qe")),n=a("YpoW"),d=a.n(n),f=/^1[3-9]\d{9}$/,c={data:function(){return{form:{visitor_reason:""},disabled:!1,fileList:[],files:{name:"",type:""},headerImage:null}},created:function(){$("title").text("访客申请"),r.a.use(o.a)},methods:{deleteFile:function(e){that.form.visitor_head1=callback.data},afterRead:function(e){e.status="uploading",e.message="上传中...",e.content="",this.files.name=e.file.name,this.files.type=e.file.type,this.imgPreview(e.file)},onSubmit:function(){var e=this;if(!f.test(e.form.user_iphone))return this.$toast.fail("手机号码格式不正确"),"";e.form.user_openid=sessionStorage.getItem("openId"),e.form.user_name&&e.form.user_iphone&&e.form.visitor_butt&&e.form.visitor_head1&&e.form.visitor_reason?l.a(s()(e.form),function(t){"ok"==t.msg?(e.$toast.success("提交成功"),e.disabled=!0):e.$toast.fail(t.msg)}):e.$toast.fail("请补充完整信息")},postImg:function(){var e=this,t=new FormData,a=this.dataURLtoFile(this.headerImage);t.append("file",a),t.append("name",a.name),console.log(t),l.e(t,function(t){console.log(t),t.sucesss?(e.fileList[0].status="",e.fileList[0].message="",e.fileList[0].url=t.sucesss,e.fileList[0].content=t.sucesss,e.$set(e.fileList),console.log(e.fileList),e.form.visitor_head1=t.sucesss):(e.fileList[0].status="failed",e.fileList[0].message="上传失败",e.$set(e.fileList),e.$toast.fail(t.error))})},imgPreview:function(e){var t=this,a=void 0;if(console.log(s()(d.a)),d.a.getData(e,function(){a=d.a.getTag(this,"Orientation")}),e&&window.FileReader&&/^image/.test(e.type)){var i=new FileReader;i.readAsDataURL(e),i.onloadend=function(){var e=this.result,i=new Image;i.src=e,this.result.length<=102400?(t.headerImage=this.result,t.postImg()):i.onload=function(){var e=t.compress(i,a);t.headerImage=e,t.postImg()}}}},dataURLtoFile:function(e){for(var t=e.split(","),a=atob(t[1]),i=a.length,s=new Uint8Array(i);i--;)s[i]=a.charCodeAt(i);return new File([s],this.files.name,{type:this.files.type})},rotateImg:function(e,t,a){if(null!=e){var i=e.height,s=e.width,r=2;null==r&&(r=0),"right"==t?++r>3&&(r=0):--r<0&&(r=3);var o=90*r*Math.PI/180,l=a.getContext("2d");switch(r){case 0:a.width=s,a.height=i,l.drawImage(e,0,0);break;case 1:a.width=i,a.height=s,l.rotate(o),l.drawImage(e,0,-i);break;case 2:a.width=s,a.height=i,l.rotate(o),l.drawImage(e,-s,-i);break;case 3:a.width=i,a.height=s,l.rotate(o),l.drawImage(e,-s,0)}}},compress:function(e,t){var a=document.createElement("canvas"),i=a.getContext("2d"),s=document.createElement("canvas"),r=s.getContext("2d"),o=e.src.length,l=e.width,n=e.height,d=void 0;(d=l*n/4e6)>1?(console.log("大于400万像素"),l/=d=Math.sqrt(d),n/=d):d=1,a.width=l,a.height=n,i.fillStyle="#fff",i.fillRect(0,0,a.width,a.height);var f=void 0;if((f=l*n/1e6)>1){console.log("超过100W像素");var c=~~(l/(f=~~(Math.sqrt(f)+1))),h=~~(n/f);s.width=c,s.height=h;for(var u=0;u<f;u++)for(var m=0;m<f;m++)r.drawImage(e,u*c*d,m*h*d,c*d,h*d,0,0,c,h),i.drawImage(s,u*c,m*h,c,h)}else i.drawImage(e,0,0,l,n);if(""!=t&&1!=t)switch(t){case 6:this.rotateImg(e,"left",a);break;case 8:this.rotateImg(e,"right",a);break;case 3:this.rotateImg(e,"right",a),this.rotateImg(e,"right",a)}var v=a.toDataURL("image/jpeg",.1);return console.log("压缩前："+o),console.log("压缩后："+v.length),console.log("压缩率："+~~(100*(o-v.length)/o)+"%"),s.width=s.height=a.width=a.height=0,v}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"content"},[a("van-form",{on:{submit:e.onSubmit}},[a("div",{staticClass:"van-cell van-cell--required van-field"},[a("div",{staticClass:"van-cell__title van-field__label"},[a("span",[e._v("头像")])]),e._v(" "),a("div",{staticClass:"van-cell__value van-field__value"},[a("div",{staticClass:"van-field__body"},[a("div",{staticClass:"van-field__control van-field__control--right"},[a("van-uploader",{attrs:{"preview-size":"100px","after-read":e.afterRead,"max-count":1,delete:e.deleteFile,deletable:!e.disabled},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}})],1)])])]),e._v(" "),a("van-field",{attrs:{type:"text",label:"名称",placeholder:"请填写名称","input-align":"right",required:"",readonly:e.disabled},model:{value:e.form.user_name,callback:function(t){e.$set(e.form,"user_name",t)},expression:"form.user_name"}}),e._v(" "),a("van-field",{attrs:{type:"text",label:"手机号",placeholder:"请填写手机号","input-align":"right",required:"",readonly:e.disabled},model:{value:e.form.user_iphone,callback:function(t){e.$set(e.form,"user_iphone",t)},expression:"form.user_iphone"}}),e._v(" "),a("van-field",{attrs:{type:"text",label:"被访人",placeholder:"请填写被访人姓名","input-align":"right",required:"",readonly:e.disabled},model:{value:e.form.visitor_butt,callback:function(t){e.$set(e.form,"visitor_butt",t)},expression:"form.visitor_butt"}}),e._v(" "),a("van-field",{attrs:{type:"textarea",label:"访问理由",placeholder:"请填写访问理由","input-align":"right",autosize:"","show-word-limit":"",maxlength:"50",required:"",readonly:e.disabled},model:{value:e.form.visitor_reason,callback:function(t){e.$set(e.form,"visitor_reason",t)},expression:"form.visitor_reason"}}),e._v(" "),a("div",{staticStyle:{width:"70vw",margin:"15vw auto"}},[a("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit",size:"small",disabled:e.disabled}},[e._v("\n\t\t\t\t\t提交\n\t\t\t\t")])],1)],1)],1)])},staticRenderFns:[]};var u=a("VU/8")(c,h,!1,function(e){a("8ANU")},"data-v-178ccd28",null);t.default=u.exports}});